<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 1st December 2004), see www.w3.org">
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii">

  <title>MonALISA User Guide</title>
  <link rel="stylesheet" href="docbook.css" type="text/css">
  <link rev="made" href="support@monalisa.cacr.caltech.edu">
  <meta name="generator" content="DocBook XSL Stylesheets V1.67.2">
  <meta xmlns="http://www.w3.org/TR/xhtml1/transitional" name=
  "generator" content="Experimental LDP.XSL $Revision: 1.3 $">
  <!-- Generated by LDP XSLT customization layer
      based on Norman Walsh's DocBook XSL stylesheets.
      More information at http://www.linuxdoc.org/ -->
</head>

<body bgcolor="white" text="black" link="#0000FF" vlink="#840084"
alink="#0000FF">
  <div class="book" lang="en">
    <div class="titlepage">
      <div>
        <div>
          <h1 class="title"><a name="BookId" id=
          "BookId"></a>MonALISA User Guide</h1>
        </div>

        <div>
          <p class="copyright">Copyright &#169; 2005 California
          Institute of Technology</p>
        </div>
      </div>
      <hr>
    </div>

    <div class="toc">
      <p><b>Table of Contents</b></p>

      <dl>
        <dt><span class="preface"><a href=
        "#preface">Preface</a></span></dt>

        <dt><span class="chapter"><a href="#install-guide">1.
        MonALISA Installation Guide</a></span></dt>

        <dd>
          <dl>
            <dt><span class="sect1"><a href="#what-you-need">1.1.
            What you need for running MonALISA
            service?</a></span></dt>

            <dt><span class="sect1"><a href="#tools">1.2. Tools
            used for getting monitoring information</a></span></dt>

            <dd>
              <dl>
                <dt><span class="sect2"><a href="#snmp">1.2.1.
                SNMP</a></span></dt>

                <dt><span class="sect2"><a href=
                "#proc-files">1.2.2. Kernel /proc
                files</a></span></dt>

                <dt><span class="sect2"><a href="#ganglia">1.2.3.
                Ganglia</a></span></dt>
              </dl>
            </dd>

            <dt><span class="sect1"><a href=
            "#installing-ml-service">1.3. Installing the MonALISA
            Service</a></span></dt>

            <dd>
              <dl>
                <dt><span class="sect2"><a href=
                "#service-dir-contents">1.3.1. What does the
                service directory contain ?</a></span></dt>
              </dl>
            </dd>
          </dl>
        </dd>

        <dt><span class="chapter"><a href="#config-guide">2.
        MonALISA Configuration Guide</a></span></dt>

        <dd>
          <dl>
            <dt><span class="sect1"><a href=
            "#global-ml-config-file">2.1. Global configuration
            file</a></span></dt>

            <dt><span class="sect1"><a href=
            "#ml-service-properties">2.2. The MonALISA
            properties</a></span></dt>

            <dt><span class="sect1"><a href="#ml-farm-config">2.3.
            The MonALISA Farm Configuration and Measured
            Parameters</a></span></dt>

            <dd>
              <dl>
                <dt><span class="sect2"><a href=
                "#ml-farm-config-snmp">2.3.1. Monitoring a Farm
                using snmp</a></span></dt>

                <dt><span class="sect2"><a href=
                "#ml-farm-config-ganglia-gmon">2.3.2. Monitoring a
                Farm using Ganglia gmon module</a></span></dt>

                <dt><span class="sect2"><a href=
                "#ml-farm-config-ganglia-multicast">2.3.3.
                Monitoring a Farm using Ganglia Multicast
                module</a></span></dt>

                <dt><span class="sect2"><a href=
                "#ml-farm-config-pbs">2.3.4. Getting Job related
                information from PBS</a></span></dt>

                <dt><span class="sect2"><a href=
                "#ml-farm-config-apmon">2.3.5. Monitoring
                Applications</a></span></dt>
              </dl>
            </dd>

            <dt><span class="sect1"><a href="#ml-db-config">2.4.
            Database support configuration</a></span></dt>

            <dt><span class="sect1"><a href=
            "#ml-farm-files-setup">2.5. How to setup the
            configuration files for your site</a></span></dt>

            <dt><span class="sect1"><a href=
            "#start-ml-service-from-initd">2.6. How to start a
            Monitoring Service from init.d</a></span></dt>

            <dt><span class="sect1"><a href=
            "#start-ml-service-with-autoupdate">2.7. How to start a
            Monitoring Service with Autoupdate</a></span></dt>

            <dt><span class="sect1"><a href=
            "#ml-service-under-fiewall">2.8. Running MonALISA
            behind a firewall</a></span></dt>

            <dt><span class="sect1"><a href=
            "#writing-ml-modules">2.9. Writing new Monitoring
            Modules</a></span></dt>

            <dt><span class="sect1"><a href=
            "#writing-ml-filters">2.10. Writing new
            Filters</a></span></dt>
          </dl>
        </dd>

        <dt><span class="chapter"><a href="#ml-features">3.
        MonALISA Features</a></span></dt>

        <dd>
          <dl>
            <dt><span class="sect1"><a href=
            "#remote-control-and-config-of-apps">3.1. Remote
            Control and Configuration of
            Applications</a></span></dt>

            <dd>
              <dl>
                <dt><span class="sect2"><a href=
                "#general-description">3.1.1. General
                description</a></span></dt>

                <dt><span class="sect2"><a href="#id2839538">3.1.2.
                Client-Server Protocol</a></span></dt>

                <dt><span class="sect2"><a href=
                "#writing-app-modules">3.1.3. Writing New Modules
                for AppControl</a></span></dt>

                <dt><span class="sect2"><a href="#id2840694">3.1.4.
                Remote Interface for MonALISA Modules
                Management</a></span></dt>

                <dt><span class="sect2"><a href="#id2840712">3.1.5.
                Clients for the Application Control
                Interface</a></span></dt>
              </dl>
            </dd>

            <dt><span class="sect1"><a href="#ws-for-ml">3.2. Web
            Services for MonALISA</a></span></dt>

            <dd>
              <dl>
                <dt><span class="sect2"><a href=
                "#ws-description">3.2.1. Service
                description</a></span></dt>

                <dt><span class="sect2"><a href=
                "#ws-implementation">3.2.2. Service
                implementation</a></span></dt>

                <dt><span class="sect2"><a href=
                "#ws-client-examples">3.2.3. Clients Examples for
                MLWebService</a></span></dt>
              </dl>
            </dd>
          </dl>
        </dd>

        <dt><span class="chapter"><a href="#proxy-service">4. Proxy
        Service</a></span></dt>

        <dd>
          <dl>
            <dt><span class="sect1"><a href="#id2841352">4.1. Why
            this proxy?</a></span></dt>

            <dt><span class="sect1"><a href="#id2841414">4.2. Where
            are these proxy services? The communication with
            clients</a></span></dt>
          </dl>
        </dd>

        <dt><span class="chapter"><a href="#ml-repositories">5.
        MonALISA Repositories</a></span></dt>

        <dd>
          <dl>
            <dt><span class="sect1"><a href="#id2841471">5.1.
            Currently available repositories</a></span></dt>
          </dl>
        </dd>

        <dt><span class="chapter"><a href=
        "#other-related-topics">6. Other Related
        Topics</a></span></dt>

        <dd>
          <dl>
            <dt><span class="sect1"><a href=
            "#how-to-test-snmp">6.1. How to test
            SNMP</a></span></dt>
          </dl>
        </dd>
      </dl>
    </div>

    <div class="list-of-examples">
      <p><b>List of Examples</b></p>

      <dl>
        <dt>2.1. <a href="#ex-farm-config-with-snmp">Farm
        configuration with SNMP</a></dt>

        <dt>2.2. <a href="#ex-farm-config-with-ganglia-gmon">Farm
        configuration with Ganglia gmon</a></dt>

        <dt>6.1. <a href="#id2841730">SNMP</a></dt>
      </dl>
    </div>

    <div class="preface" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="preface" id=
            "preface"></a>Preface</h2>
          </div>
        </div>
      </div>

      <p>The MonALISA framework provides a distributed monitoring
      service system using JINI/JAVA and WSDL/SOAP technologies.
      Each MonALISA server acts as a dynamic service system and
      provides the functionality to be discovered and used by any
      other services or clients that require such information.</p>

      <p>MonALISA is entirely written in java. The distribution is
      packed in several self contain jar files. Practically it is
      required to have only java installed on the system hosting
      the MonALISA Service (NOT on the monitored nodes!). The way
      to configure and use the service is described in this guide.
      MonALISA also allows to dynamically add new monitoring
      modules, Filters or Agents.</p>

      <div class="important" style=
      "margin-left: 0.5in; margin-right: 0.5in;">
        <h3 class="title">Important</h3>

        <p>Running a MonALISA service does not require any root
        privilegies, and we strongly suggest to do not use the
        service from a root account.</p>
      </div>

      <div class="warning" style=
      "margin-left: 0.5in; margin-right: 0.5in;">
        <h3 class="title">Warning</h3>

        <p>Do not run MonALISA on a distributed file system!</p>
      </div>
    </div>

    <div class="chapter" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="install-guide" id=
            "install-guide"></a>Chapter&nbsp;1.&nbsp;MonALISA
            Installation Guide</h2>
          </div>
        </div>
      </div>

      <div class="toc">
        <p><b>Table of Contents</b></p>

        <dl>
          <dt><span class="sect1"><a href="#what-you-need">1.1.
          What you need for running MonALISA
          service?</a></span></dt>

          <dt><span class="sect1"><a href="#tools">1.2. Tools used
          for getting monitoring information</a></span></dt>

          <dd>
            <dl>
              <dt><span class="sect2"><a href="#snmp">1.2.1.
              SNMP</a></span></dt>

              <dt><span class="sect2"><a href="#proc-files">1.2.2.
              Kernel /proc files</a></span></dt>

              <dt><span class="sect2"><a href="#ganglia">1.2.3.
              Ganglia</a></span></dt>
            </dl>
          </dd>

          <dt><span class="sect1"><a href=
          "#installing-ml-service">1.3. Installing the MonALISA
          Service</a></span></dt>

          <dd>
            <dl>
              <dt><span class="sect2"><a href=
              "#service-dir-contents">1.3.1. What does the service
              directory contain ?</a></span></dt>
            </dl>
          </dd>
        </dl>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "what-you-need" id="what-you-need"></a>1.1.&nbsp;What
              you need for running MonALISA service?</h2>
            </div>
          </div>
        </div>

        <p>For running a MonALISA service you need to have the java
        runtime environment (j2se 1.4.2 or higher) installed on one
        system that will run the Monitoring Service for an entire
        farm. For development of dedicated modules or agents the
        user should install the entire JDK.</p>

        <p>Setting the environment to run java may look like
        this:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="programlisting">
        JAVA_HOME=$HOME/JAVA/jdk
        export JAVA_HOME
        export PATH=$JAVA_HOME/bin:$PATH
        
</pre>
            </td>
          </tr>
        </table>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name="tools"
              id="tools"></a>1.2.&nbsp;Tools used for getting
              monitoring information</h2>
            </div>
          </div>
        </div>

        <p>Collecting the monitoring information can be done in
        several ways using dynamically loadable modules.</p>

        <p>It is possible to collect information using:</p>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              <p>SNMP demons;</p>
            </li>

            <li>
              <p>Ganglia;</p>
            </li>

            <li>
              <p>LSF or PBS batch queueing systems;</p>
            </li>

            <li>
              <p>Local or remote procedures to read <code class=
              "filename">/proc</code> files;</p>
            </li>

            <li>
              <p>User modules based on dedicated scripts or
              procedures.</p>
            </li>
          </ul>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="snmp" id=
                "snmp"></a>1.2.1.&nbsp;SNMP</h3>
              </div>
            </div>
          </div>

          <p>MonALISA has dedicated modules to collect values
          provided by snmp demons. Using snmp modules requires that
          the snmpd demons are installed and properly configured on
          the nodes or network elements (switches or routers) the
          user want to monitor.</p>

          <p>Please see <a href="#how-to-test-snmp" title=
          "6.1.&nbsp;How to test SNMP">Section&nbsp;6.1, &#8220;How
          to test SNMP&#8221;</a> to see how to test the well
          installation of snmp.</p>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="proc-files" id=
                "proc-files"></a>1.2.2.&nbsp;Kernel /proc
                files</h3>
              </div>
            </div>
          </div>

          <p>Modules to collect the system monitoring information
          from the kernel are part of the MonALISA distribution.
          These modules are mainly design to be used on the node
          MonALISA service is running but they may also be used on
          remote systems via rsh or ssh.</p>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ganglia" id=
                "ganglia"></a>1.2.3.&nbsp;Ganglia</h3>
              </div>
            </div>
          </div>

          <p>Ganglia is a well known monitoring system which is
          using a multi cast messaging system to collect system
          information from large clusters. MonALISA can be easily
          interfaced with Ganglia. This can be done using the
          multicast messaging system or the gmon interface which is
          based on getting the cluster monitoring information in
          XML format. In the MonALISA distribution we provide
          modules for both these two possibilities. If the MonALISA
          service runs in the multicast range for the nodes sending
          monitoring data, we suggest using the Ganglia module
          which is a multicast listener. The code for interfacing
          MonALISA with Ganglia using gmon is <code class=
          "filename">Service/usr_code/GangliaMod</code> and using
          the multicast messages is <code class=
          "filename">Service/usr_code/GangliaMCAST</code>. The user
          may modify these modules. Please look at the service
          configuration examples to see how these modules may be
          used.</p>
        </div>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "installing-ml-service" id=
              "installing-ml-service"></a>1.3.&nbsp;Installing the
              MonALISA Service</h2>
            </div>
          </div>
        </div>

        <p>The MonALISA Service package comes with installation
        scripts which can be followed step-by-step for an automatic
        installation procedure, or you can manually configure the
        service.</p>

        <p>The automatical installation of MonALISA Service:</p>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              <p>The scripts from the distribution that help you
              install and configure MonALISA are <code class=
              "filename">install.sh</code> and <code class=
              "filename">install2.sh</code>.</p>
            </li>

            <li>
              <p>The <code class="filename">install.sh</code>
              script will check to see whether the user is root or
              not. If the user is not root, then the <code class=
              "filename">install2.sh</code> script is executed.</p>
            </li>

            <li>
              <p>If the user is root then he will be asked for an
              account from which MonaLisa will run.</p>
            </li>

            <li>
              <p>If the specified account does not exist then the
              script will attempt to create one, it will create a
              <code class="filename">monalisa_install</code>
              directory in this account, it will copy the
              <code class="filename">install2.sh</code> and
              <code class="filename">MonaLisa.v1.2.tar.gz</code> in
              the user's <code class=
              "filename">~/monalisa_install</code> directory, and
              will start <code class="filename">install2.sh</code>
              from there. After <code class=
              "filename">install2.sh</code> finishes its execution,
              the <code class="filename">~/monalisa_install</code>
              will be deleted.</p>
            </li>
          </ul>
        </div>

        <p>The <code class="filename">install2.sh</code> script
        will ask for a destination folder, unpack the <code class=
        "filename">MonaLisa.v1.2.tar.gz</code> file and ask for the
        farm configuration options. Make sure that the destination
        folder chosen is not <code class="filename">.</code>(
        <code class="filename">monalisa_install</code>) or
        something like ( <code class=
        "filename">./monalisa_install/&lt;destination_folder&gt;</code>)
        because the <code class="filename">monalisa_install</code>
        directory will be deleted after the installation
        procedure.</p>

        <p>After unpacking the service,the <code class=
        "filename">install2.sh</code> script will ask the user for
        abasicconfiguration. You will be asked to set the farm name
        (default to thehostnameof the computer) and you have to be
        sure that this name is unique in theMonALISA environment.
        You will also be asked to set the Latitude and Longitudeof
        the server. Aproximative values can be found at <a href=
        "http://geotags.com/" target=
        "_top">http://geotags.com/</a>.</p>

        <p>If the destination folder already contains an older
        MonALISA installation then all the configuration files are
        kept unchanged. In fact the <code class=
        "filename">CMD</code>, <code class="filename">TEST</code>
        and <code class="filename">VDTFarm</code> folders remain
        untouched, which is bad if you runan older version of
        MonALISA. So if you want to upgrade from an older
        MonALISAinstallation please choose another destination
        folder and then heck if thenewly generated configuration is
        correct.</p>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="service-dir-contents"
                id="service-dir-contents"></a>1.3.1.&nbsp;What does
                the service directory contain ?</h3>
              </div>
            </div>
          </div>

          <p>After unpacking the service archive, you can find the
          following structure:</p>

          <div class="variablelist">
            <dl>
              <dt><span class="term">Service</span></dt>

              <dd>
                <div class="variablelist">
                  <dl>
                    <dt><span class="term">CMD</span></dt>

                    <dd>
                      <p>this directory contains a set of scripts
                      that are used for the management of the
                      MonALISA service execution:</p>

                      <div class="itemizedlist">
                        <ul type="disc">
                          <li>
                            <p>the <code class=
                            "filename">MLD</code> script is used to
                            start the Monitoring Service from
                            <code class="filename">init.d</code>.
                            See details in <a href=
                            "#start-ml-service-from-initd" title=
                            "2.6.&nbsp;How to start a Monitoring Service from init.d">
                            Section&nbsp;2.6, &#8220;How to start a
                            Monitoring Service from
                            init.d&#8221;</a> section from this
                            guide.</p>
                          </li>

                          <li>
                            <p>the <code class=
                            "filename">CHECK_UPDATE</code> script
                            is used to automatically update the
                            Monitoring Service. See details in
                            <a href=
                            "#start-ml-service-with-autoupdate"
                            title=
                            "2.7.&nbsp;How to start a Monitoring Service with Autoupdate">
                            Section&nbsp;2.7, &#8220;How to start a
                            Monitoring Service with
                            Autoupdate&#8221;</a> section from this
                            guide.</p>
                          </li>

                          <li>
                            <p>the <code class=
                            "filename">ML_SER</code> script is used
                            to start, stop or restart the
                            Monitoring Service.</p>
                          </li>

                          <li>
                            <p>in the <code class=
                            "filename">ml_env</code> file you have
                            to set some environment variables. This
                            is the only file from this directory
                            that can be modified. See details about
                            how to set these variables in <a href=
                            "#global-ml-config-file" title=
                            "2.1.&nbsp;Global configuration file">Section&nbsp;2.1,
                            &#8220;Global configuration
                            file&#8221;</a> section from this
                            guide.</p>
                          </li>
                        </ul>
                      </div>
                    </dd>

                    <dt><span class="term">SSecurity</span></dt>

                    <dd>
                      <p>this directory contains the farm keystore
                      (<code class=
                      "filename">FarmMonitor.ks</code>). As an
                      administrator of the farm service, you can
                      export and import certificates or create keys
                      using <code class=
                      "filename">exportCert</code>, <code class=
                      "filename">importCert</code> and <code class=
                      "filename">genKey</code> scripts.</p>
                    </dd>

                    <dt><span class="term">lib</span></dt>

                    <dd>
                      <p>this directory contains the service
                      packages</p>
                    </dd>

                    <dt><span class="term">ml_dl</span></dt>

                    <dd>
                      <p>it contains the dl jar for registering in
                      reggie jini service.</p>
                    </dd>

                    <dt><span class="term">myFarm</span></dt>

                    <dd>
                      <p>In this directory you can set your farm.
                      It contains the files that defines the
                      characteristics of your farm. You can rename
                      it with the name of the farm.</p>
                    </dd>

                    <dt><span class="term">usr_code</span></dt>

                    <dd>
                      <p>this directory contains sources of some
                      module examples. See details in the <a href=
                      "#writing-ml-modules" title=
                      "2.9.&nbsp;Writing new Monitoring Modules">Section&nbsp;2.9,
                      &#8220;Writing new Monitoring
                      Modules&#8221;</a> section from this
                      guide.</p>
                    </dd>
                  </dl>
                </div>
              </dd>

              <dt><span class="term">bin</span></dt>

              <dd>
                <p>contains tools used from the scripts from
                <code class="filename">Service/CMD</code>.</p>
              </dd>

              <dt><span class="term">policy</span></dt>

              <dd>
                <p>contains policy files for running the MonALISA
                service.</p>
              </dd>

              <dt><span class="term">util</span></dt>

              <dd>
                <p>contains different simple programs, their source
                and scripts for getting useful information:</p>

                <div class="variablelist">
                  <dl>
                    <dt><span class=
                    "term">ShowReceivedValues</span></dt>

                    <dd>
                      <p>a short program example that interrogates
                      a farm database and gets results from it. It
                      receives as argument a configuration file,
                      like the <code class=
                      "filename">Service/TEST/ml.properties</code>.</p>
                    </dd>

                    <dt><span class=
                    "term">ShowStoreConfig</span></dt>

                    <dd>
                      <p>a short program example that parses a farm
                      configuration file (as <code class=
                      "filename">Service/TEST/ml.properties</code>)
                      received as argument and shows the database
                      tables structure used.</p>
                    </dd>

                    <dt><span class="term">SimpleClient</span></dt>

                    <dd>
                      <p>a program example that finds the MonALISA
                      farm services registered in the reggie
                      services from the locators given in the
                      <code class="filename">locators.conf</code>
                      file and shows their attributes.</p>
                    </dd>

                    <dt><span class=
                    "term">SimpleDBShell</span></dt>

                    <dd>
                      <p>a set of useful scripts for getting
                      information from a mysql farm database. For
                      using these scripts you must first edit the
                      <code class=
                      "filename">mysql_console.sh</code> script,
                      set the variables from here and delete the
                      following lines:</p>

                      <table xmlns=
                      "http://www.w3.org/TR/xhtml1/transitional"
                      border="0" bgcolor="#E0E0E0" width="90%">
                        <tr>
                          <td>
                            <pre class="screen">
echo "Please edit mysql_console.sh first" &gt; /dev/stderr
exit
</pre>
                          </td>
                        </tr>
                      </table>All the other scripts use
                      "mysql_console.sh". Use them for getting
                      information from the farm database tables.
                    </dd>
                  </dl>
                </div>
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="chapter" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="config-guide" id=
            "config-guide"></a>Chapter&nbsp;2.&nbsp;MonALISA
            Configuration Guide</h2>
          </div>
        </div>
      </div>

      <div class="toc">
        <p><b>Table of Contents</b></p>

        <dl>
          <dt><span class="sect1"><a href=
          "#global-ml-config-file">2.1. Global configuration
          file</a></span></dt>

          <dt><span class="sect1"><a href=
          "#ml-service-properties">2.2. The MonALISA
          properties</a></span></dt>

          <dt><span class="sect1"><a href="#ml-farm-config">2.3.
          The MonALISA Farm Configuration and Measured
          Parameters</a></span></dt>

          <dd>
            <dl>
              <dt><span class="sect2"><a href=
              "#ml-farm-config-snmp">2.3.1. Monitoring a Farm using
              snmp</a></span></dt>

              <dt><span class="sect2"><a href=
              "#ml-farm-config-ganglia-gmon">2.3.2. Monitoring a
              Farm using Ganglia gmon module</a></span></dt>

              <dt><span class="sect2"><a href=
              "#ml-farm-config-ganglia-multicast">2.3.3. Monitoring
              a Farm using Ganglia Multicast module</a></span></dt>

              <dt><span class="sect2"><a href=
              "#ml-farm-config-pbs">2.3.4. Getting Job related
              information from PBS</a></span></dt>

              <dt><span class="sect2"><a href=
              "#ml-farm-config-apmon">2.3.5. Monitoring
              Applications</a></span></dt>
            </dl>
          </dd>

          <dt><span class="sect1"><a href="#ml-db-config">2.4.
          Database support configuration</a></span></dt>

          <dt><span class="sect1"><a href=
          "#ml-farm-files-setup">2.5. How to setup the
          configuration files for your site</a></span></dt>

          <dt><span class="sect1"><a href=
          "#start-ml-service-from-initd">2.6. How to start a
          Monitoring Service from init.d</a></span></dt>

          <dt><span class="sect1"><a href=
          "#start-ml-service-with-autoupdate">2.7. How to start a
          Monitoring Service with Autoupdate</a></span></dt>

          <dt><span class="sect1"><a href=
          "#ml-service-under-fiewall">2.8. Running MonALISA behind
          a firewall</a></span></dt>

          <dt><span class="sect1"><a href=
          "#writing-ml-modules">2.9. Writing new Monitoring
          Modules</a></span></dt>

          <dt><span class="sect1"><a href=
          "#writing-ml-filters">2.10. Writing new
          Filters</a></span></dt>
        </dl>
      </div>

      <p>There are three configuration files that the user can
      modify for specifying farm service environment and
      characteristics: a global configuration file (<code class=
      "filename">$MonaLisa_HOME/Service/CMD/ml_env</code>), and the
      others used by MonALISA itself ( <code class=
      "filename">$MonaLisa_HOME/Service/&lt;YOUR_FARM_DIRECTORY&gt;/ml.properties</code>
      and <code class=
      "filename">$MonaLisa_HOME/Service/&lt;YOUR_FARM_DIRECTORY&gt;/&lt;YOUR_FARM_CONF_FILE&gt;.conf</code>).</p>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "global-ml-config-file" id=
              "global-ml-config-file"></a>2.1.&nbsp;Global
              configuration file</h2>
            </div>
          </div>
        </div>

        <p>The file for the global configuration is <code class=
        "filename">$MonaLisa_HOME/Service/CMD/ml_env</code>. The
        variables that the user has to set or can set are:</p>

        <div class="variablelist">
          <dl>
            <dt><span class="term">MONALISA_USER</span></dt>

            <dd>
              <p>the name of the user that is running the service.
              It will not start from other account or from the root
              account.</p>
            </dd>

            <dt><span class="term">JAVA_HOME</span></dt>

            <dd>
              <p>the path to your current JDK.</p>
            </dd>

            <dt><span class="term">SHOULD_UPDATE</span></dt>

            <dd>
              <p>whether or not MonALISA should check for updates
              when it is started. If this parameter is "true" when
              MonALISA is started, first it will check for updates
              and after that it will start. If set to "false" it
              will not check for updates. This parameter is also
              used to check for autoupdates when it is running.
              Please see <a href=
              "#start-ml-service-with-autoupdate" title=
              "2.7.&nbsp;How to start a Monitoring Service with Autoupdate">
              Section&nbsp;2.7, &#8220;How to start a Monitoring
              Service with Autoupdate&#8221;</a> from this user
              guide.</p>
            </dd>

            <dt><span class="term">MonaLisa_HOME</span></dt>

            <dd>
              <p>path to your MonALISA installation directory.
              Environment variables can also be used. (e.g
              <code class="filename">${HOME}/MonaLisa</code>)</p>
            </dd>

            <dt><span class="term">FARM_HOME</span></dt>

            <dd>
              <p>path to a directory where reside your farm
              specific files. It's better to place this directory
              in the Service directory. (e.g. You can use the
              variable <code class="varname">MonaLisa_HOME</code>
              defined above. <code class=
              "filename">${MonaLisa_HOME}/Service/MyTest</code>.
              MonALISA comes with a simple example in <code class=
              "filename">${MonaLisa_HOME}/Service/myFarm</code>.</p>
            </dd>

            <dt><span class="term">FARM_CONF_FILE</span></dt>

            <dd>
              <p>the file used at the startup of the services to
              define the clusters, nodes and the monitor modules to
              be used. It should be in the <code class=
              "filename">${FARM_HOME}</code> directory. (e.g
              <strong class=
              "userinput"><code>FARM_CONF_FILE="${FARM_HOME}/mytest.conf"</code></strong>).</p>
            </dd>

            <dt><span class="term">FARM_NAME</span></dt>

            <dd>
              <p>the name for your farm. (e.g <strong class=
              "userinput"><code>FARM_HOME="MyTest"</code></strong>).
              We would like to ask the users to use short names to
              describe the SITE on which they are running
              MonALISA.</p>
            </dd>

            <dt><span class="term">JAVA_OPTS</span></dt>

            <dd>
              <p>is an optional parameter to pass parameters
              directly to the Java Virtual Machine (e.g
              <strong class=
              "userinput"><code>JAVA_OPTS="-Xmx=128m"</code></strong>).</p>
            </dd>
          </dl>
        </div>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "ml-service-properties" id=
              "ml-service-properties"></a>2.2.&nbsp;The MonALISA
              properties</h2>
            </div>
          </div>
        </div>

        <p>The file <code class=
        "filename">$MonaLisa_HOME/Service/&lt;YOUR_FARM_DIRECTORY&gt;/ml.properties</code>
        is specific for your farm configuration.</p>

        <p>You can specify here:</p>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              <p>what lookup services to use (<strong class=
              "userinput"><code>lia.Monitor.LUSs</code></strong>);</p>
            </li>

            <li>
              <p>the jini groups that your service should join
              (<strong class=
              "userinput"><code>lia.Monitor.group</code></strong>);</p>
            </li>

            <li>
              <p>the location of the farm server (<strong class=
              "userinput"><code>MonaLisa.LAT, MonaLisa.LONG,
              MonaLisa.Country</code></strong>);</p>
            </li>

            <li>
              <p>Web Services settings (<strong class=
              "userinput"><code>lia.Monitor.startWSDL=true</code></strong>
              starts the MonALISA web service, <strong class=
              "userinput"><code>lia.Monitor.wsdl_port</code></strong>);</p>
            </li>

            <li>
              <p>database configuration (<strong class=
              "userinput"><code>lia.Monitor.keep_history</code></strong>
              how long to keep data in farm database, parameters to
              configurate database tables, etc.);</p>
            </li>

            <li>
              <p>parameters for logging (<strong class=
              "userinput"><code>.level</code></strong> - the
              logging level - defaults to <strong class=
              "userinput"><code>INFO</code></strong>, etc.)</p>
            </li>
          </ul>
        </div>

        <p>You will find explanations before every field for
        setting it correctly).</p>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "ml-farm-config" id=
              "ml-farm-config"></a>2.3.&nbsp;The MonALISA Farm
              Configuration and Measured Parameters</h2>
            </div>
          </div>
        </div>

        <p>The MonALISA service is using a very simple
        configuration file to generate the site configuration and
        the modules to be used for collecting monitoring
        information. By using the administrative interface with SSL
        connection the user may dynamically change the
        configuration and modules used to collect data.</p>

        <p>It is possible to use the build modules (for snmp, local
        or remote <code class="filename">/proc</code> file...) or
        external modules. We provide several modules which allow
        exchanging information with other monitoring tools. These
        modules are really very simple and the user can also
        develop its own modules.</p>

        <p>Below we will present a few simple examples in how to
        make the configuration for a farm. This file is the
        <strong class="userinput"><code>.conf</code></strong> file
        from your <code class=
        "filename">Service/&lt;FARM_DIRECTORY&gt;</code>
        directory.</p>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ml-farm-config-snmp" id=
                "ml-farm-config-snmp"></a>2.3.1.&nbsp;Monitoring a
                Farm using snmp</h3>
              </div>
            </div>
          </div>

          <p>The configuration file should look like this:</p>

          <div class="example">
            <a name="ex-farm-config-with-snmp" id=
            "ex-farm-config-with-snmp"></a>

            <p class="title"><b>Example&nbsp;2.1.&nbsp;Farm
            configuration with SNMP</b></p>

            <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
            border="0" bgcolor="#E0E0E0" width="90%">
              <tr>
                <td>
                  <pre class="screen">
    *Master   
    &gt;citgrid3.cacr.caltech.edu citgrid3   
    monProcLoad%30   
    monProcStat%30   
    monProcIO%30
    
    *ABPing{monABPing, citgrid3.cacr.caltech.edu, " "}   
    
    *PN_CIT
    &gt;c0-0   
    snmp_Load%30   
    snmp_IO%30   
    snmp_CPU%30   
    &gt;c0-1   
    snmp_Load%30   
    snmp_IO%30   
    snmp_CPU%30   
    &gt;c0-2   
    snmp_Load%30   
    snmp_IO%30   
    snmp_CPU%30   
    &gt;c0-3  
    snmp_Load%30   
    snmp_IO%30   
    snmp_CPU%30
</pre>
                </td>
              </tr>
            </table>
          </div>

          <p>The first line (<strong class=
          "userinput"><code>*Master</code></strong>) defines a
          Functional Unit (or Cluster). The second line
          (<strong class=
          "userinput"><code>&gt;citgrid3.cacr.caltech.edu
          citgrid3</code></strong>) adds a node in this Functional
          Unit class and optionally an alias. The lines:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
    monProcLoad%30   
    monProcIO%30   
    monProcStat%30
</pre>
              </td>
            </tr>
          </table>define three monitoring modules to be used on the
          node "citgrid3". These measurements are done
          periodically, every 30s. The <strong class=
          "userinput"><code>monProc*</code></strong> modules are
          using the local <code class="filename">/proc</code> files
          to collect information about the cpu, load and IO. In
          this case this is a master node for a cluster, were in
          fact MonALISA service is running and simple modules using
          the <code class="filename">/proc</code> files used to
          collect data.

          <p>The line:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
    *ABPing{monABPing, citgrid3.cacr.caltech.edu, " "}
        
</pre>
              </td>
            </tr>
          </table>defines a Functional unit named "ABPing" which is
          using an internal module <strong class=
          "userinput"><code>monABPing</code></strong>. This module
          is used to perform simple network measurements using
          small UDP packages. It requires as the first parameter
          the full name of the system corresponding the real IP on
          which the ABping server is running (as part of the
          MonALISA service). The second parameter is not used.
          These ABPing measurements are used to provide information
          about the quality of connectivity among different centers
          as well as for dynamically computing optimal trees for
          connectivity (minimum spanning tree, minimum path for any
          node to all the others...)

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
*PN_CIT
</pre>
              </td>
            </tr>
          </table>defines a new cluster name. This is for a set of
          processing nodes used by the site. The string "PN" in the
          name is necessary if the user wants to automatically use
          filters to generate global views for all this processing
          units.

          <p>Then it has a list of nodes in the cluster and for
          each node a list of modules to be used for getting
          monitoring information from the nodes. For each module a
          repetition time is defined (%30). This means that each
          such module is executed once every 30s. Defining the
          repeating time is optional and the default value is
          30s.</p>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name=
                "ml-farm-config-ganglia-gmon" id=
                "ml-farm-config-ganglia-gmon"></a>2.3.2.&nbsp;Monitoring
                a Farm using Ganglia gmon module</h3>
              </div>
            </div>
          </div>

          <p>The configuration file should look like this:</p>

          <div class="example">
            <a name="ex-farm-config-with-ganglia-gmon" id=
            "ex-farm-config-with-ganglia-gmon"></a>

            <p class="title"><b>Example&nbsp;2.2.&nbsp;Farm
            configuration with Ganglia gmon</b></p>

            <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
            border="0" bgcolor="#E0E0E0" width="90%">
              <tr>
                <td>
                  <pre class="screen">
    *Master   
    &gt;ramen gateway    
    monProcLoad%30   
    monProcIO%30   
    monProcStat%30   
    
    *PN_popcrn {IGanglia, popcrn01.fnal.gov, 8649}   
    
    *ABPing{monABPing, ramen.fnal.gov, " "}   
    
    *Internet   
    &gt;tier2.cacr.caltech.edu   
    monPing%50
       
</pre>
                </td>
              </tr>
            </table>
          </div>

          <p>The first line (<strong class=
          "userinput"><code>*Master</code></strong>) defines a
          Functional Unit (or Cluster). The Second line
          (<strong class="userinput"><code>&gt;ramen
          gateway</code></strong>) adds a node in this Functional
          Unit class. In this case ramen is a computer name and
          optionally the user may add an alias (gateway to this
          name).</p>

          <p>The lines:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
monProcLoad%30  
monProcIO%30   
monProcStat%30
</pre>
              </td>
            </tr>
          </table>define three monitoring modules to be used on the
          node "ramen". These measurements are done every 30s. The
          <strong class="userinput"><code>monProc*</code></strong>
          modules are using the local <code class=
          "filename">/proc</code> files to collect information
          about the cpu, load and IO.

          <p>The line:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
*PN_popcrn {IGanglia, popcrn01.fnal.gov, 8649}%30
</pre>
              </td>
            </tr>
          </table>defines a cluster named "PN_popcrn" for which the
          entire information is provided by the IGanglia module.
          This module is using telnet to get an XML based output
          from the Ganglia gmon. The telnet request will be sent to
          node <strong class=
          "userinput"><code>popcrn01.fnal.gov</code></strong> on
          port 8649.

          <p>All the nodes which report to ganglia will be part of
          this cluster unit and for all of them the parameters
          selected in the IGanglia module will be recorded. This
          measurement will de done every 30s.</p>

          <p>The Ganglia module is located in the <code class=
          "filename">Service/usr_code/GangliaMod</code>. The user
          may edit the file and customize it. This module is NOT in
          the MonaLISA jar files and for using it the user MUST add
          the path to this module to the MonaLISA loader. This can
          be done in <code class="filename">ml.propreties</code> by
          adding this line:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
lia.Monitor.CLASSURLs=file:${MonaLisa_HOME}/Service/usr_code/GangliaMod/
</pre>
              </td>
            </tr>
          </table>

          <p>The line:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
*ABPing{monABPing, ramen.fnal.gov, " "}
</pre>
              </td>
            </tr>
          </table>defines a Functional unit named "ABPing" which is
          using an internal module <strong class=
          "userinput"><code>monABPing</code></strong>. This module
          is used to perform simple network measurements using
          small UDP packages. The first parameter must be the full
          name of the system which corresponds to the real IP on
          which the ABping server is running. The second parameter
          is not used.

          <p>The next lines:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
*Internet    
 &gt;tier2.cacr.caltech.edu caltech monPing%50 
</pre>
              </td>
            </tr>
          </table>define a new functional unit (Internet) having
          one node

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
tier2.cacr.caltech.edu
</pre>
              </td>
            </tr>
          </table>with the alias caltech for which a ping
          measurement is done by the monPing module every 50s.
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name=
                "ml-farm-config-ganglia-multicast" id=
                "ml-farm-config-ganglia-multicast"></a>2.3.3.&nbsp;Monitoring
                a Farm using Ganglia Multicast module</h3>
              </div>
            </div>
          </div>

          <p>For getting copies of the monitoring data sent by the
          nodes running the ganglia demons (using a multicast port)
          it is necessary that the system on which MonaLISA is
          running to be in muticast range for these messages.</p>

          <p>Adding such a line:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
*PN_cit{monMcastGanglia, tier2, "GangliaMcastAddress=239.2.11.71; GangliaMcastPort=8649"}
</pre>
              </td>
            </tr>
          </table>in the configuration file, will use the Ganglia
          multicast module to listen to all the monitoring data and
          then to select certain values which will be recorded into
          MonALISA. The service system will automatically create a
          configuration for all the nodes which report data in this
          way.

          <p>The <strong class=
          "userinput"><code>PN_cit</code></strong> is the name of
          the cluster of processing nodes. Is is important for the
          cluster name of processing nodes to contain the "PN"
          string. This is used by farm filters to report global
          views for the farms.</p>

          <p>The <strong class=
          "userinput"><code>tier2</code></strong> is the name of
          the system corresponding to the real IP address on which
          this MonALISA service is running. The second parameter
          defines the multicast address and port used by
          Ganglia.</p>

          <p>The GangliaMcat module is located in the <code class=
          "filename">Service/usr_code/GangliaMCAST</code>. The user
          may edit the file and customize it. This module is NOT in
          the MonaLISA jar files and to be used, the user MUST add
          the path to this module to the MonaLISA loader. This can
          be done in <code class="filename">ml.propreties</code> by
          adding this line:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
lia.Monitor.CLASSURLs=file:${MonaLisa_HOME}/Service/usr_code/GangliaMCAST/ 
</pre>
              </td>
            </tr>
          </table>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ml-farm-config-pbs" id=
                "ml-farm-config-pbs"></a>2.3.4.&nbsp;Getting Job
                related information from PBS</h3>
              </div>
            </div>
          </div>

          <p>To monitor data provided by the PBS, you will need to
          add these line into the config file:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
*JOBS
&gt;tier2   PBSjobs{cmsim,ooHits}%30 
</pre>
              </td>
            </tr>
          </table>

          <p>The first line defines the name of the functional unit
          (JOBS). The second line defines the node (normally the
          current system) where the PBSJobs module will run. The
          module has a parameter containing a list o jobs for which
          information will be provided. The module will run every
          30s. The code of the PBSJobs module is in <code class=
          "filename">Service/usr_code/PBS/</code> and must be added
          to the MonaLISA class loader in similar way like the
          Ganglia modules.</p>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ml-farm-config-apmon"
                id="ml-farm-config-apmon"></a>2.3.5.&nbsp;Monitoring
                Applications</h3>
              </div>
            </div>
          </div>

          <p>MonALISA monitor external applications using ApMon
          API. In order to configure MonALISA to listen on UDP port
          8884 for incoming datagrams (XDR encoded, using ApMon)
          you should add the following line in your config
          file:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
^monXDRUDP{ListenPort=8884}%30 
</pre>
              </td>
            </tr>
          </table>

          <p>The Clusters, Nodes and Parameters are dynamically
          created in MonALISA's configuration tree every time a new
          one is received. It is possible, also, to dynamically
          remove "unused" Clusters/Nodes/Parameters, if there are
          no datagrams to match them for a period of time. The
          timeouts are in seconds:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
^monXDRUDP{ParamTimeout=10800,NodeTimeout=10800,ClusterTimeout=86400,ListenPort=8884}%30 
</pre>
              </td>
            </tr>
          </table>In the example above the parameters and the nodes
          are automatically removed from ML configuration tree if
          there are no data received for 3 hours (10800 seconds).
          The Cluster is removed after one day (24 hours - 86400
          seconds).

          <p>For further informations how to send data into
          MonALISA please see ApMon API documentation.</p>
        </div>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "ml-db-config" id=
              "ml-db-config"></a>2.4.&nbsp;Database support
              configuration</h2>
            </div>
          </div>
        </div>

        <p>The configuration options relevant to the storage are
        set in the <code class=
        "filename">FARMNAME/ml.properties</code> file:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.use_emysqldb=true|false
</pre>
            </td>
          </tr>
        </table>this will unpack the embedded mysql (if any)

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.use_epgsqldb=true|false
</pre>
            </td>
          </tr>
        </table>for the embedded postgresql

        <p>If none of these options is enabled then the following
        options are relevant for the database server selection:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.jdbcDriverString=
       com.mckoi.JDBCDriver      or
       com.mysql.jdbc.Driver     or
       org.postgresql.Driver
</pre>
            </td>
          </tr>
        </table>

        <p>McKoi is the default database if nothing else is
        available, but we don't recommend using it for storing
        large data structures. If you have a standalone database
        server you should disable the embedded databases and
        specify the mysql or postgresql driver here accordingly.
        The following parameters are the connection parameters for
        the JDBC driver.</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.ServerName=IP_ADDRESS
lia.Monitor.DatabasePort=TCP_PORT
lia.Monitor.DatabaseName=DB_NAME
lia.Monitor.UserName=DB_USERNAME
lia.Monitor.Pass=DB_PASSWORD
</pre>
            </td>
          </tr>
        </table>

        <p>The actual database structure is determined by the
        following options:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.Store.TransparentStoreFast.web_writes=N
</pre>
            </td>
          </tr>
        </table>

        <p>this option specify the number of tables that are used.
        For each X=0..N-1 you should have:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.Store.TransparentStoreFast.writer_X.total_time=SECONDS
lia.Monitor.Store.TransparentStoreFast.writer_X.table_name=UNIQUE_NAME
lia.Monitor.Store.TransparentStoreFast.writer_X.writemode=MODE
lia.Monitor.Store.TransparentStoreFast.writer_X.samples=SAMPLES
lia.Monitor.Store.TransparentStoreFast.writer_X.descr=UNIQUE_STRING
</pre>
            </td>
          </tr>
        </table>

        <p>SECONDS specify the time period for which the data is
        stored in the database. Data older than now()-SECONDS will
        be automatically deleted.</p>

        <p>The "table_name" and "descr" should be unique among the
        other options of the same kind. "table_name" must be a
        valid database table name (no spaces and so on), "descr"
        can be any string you like.</p>

        <p>You can store data in either averaged or raw modes. When
        using and averaged mode the SAMPLES value determine the
        number of values that are kept for the specified interval.
        For example if you want to store a single value each minute
        for an year you should specify SECONDS=31536000 and
        SAMPLES=SECONDS/60=525600. This is applied separately for
        each parameter that you store, so such a database can
        become rather large.</p>

        <p>MODE has these possible values:</p>

        <div class="variablelist">
          <dl>
            <dt><span class="term">0: averaged mode</span></dt>

            <dd>
              <p>the table structure will be</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
rectime | farm | cluster | node | function | mval   | mmin   | mmax
long    | text | text    | text | text     | double | double | double
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">1: raw mode</span></dt>

            <dd>
              <p>same structure as 0</p>
            </dd>

            <dt><span class="term">2: raw mode for storing abstract
            Object values</span></dt>

            <dd>
              <p>seldom used</p>
            </dd>

            <dt><span class="term">3: averaged mode, data is only
            kept in memory</span></dt>

            <dd>
              <p>to control the maximum size of the in-memory
              buffer use:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
lia.Monitor.Store.TransparentStoreFast.writer_X.countLimit
</pre>
                  </td>
                </tr>
              </table>if set to -1 then only the time limit given
              by SECONDS is relevant
            </dd>

            <dt><span class="term">4: raw mode, in memory, same as
            3 but without data averaging</span></dt>

            <dt><span class="term">5, 6 : averaged / raw modes for
            an optimized table structure</span></dt>

            <dd>
              <p>each <code class=
              "filename">farm/cluster/node/function</code>
              combination is given an unique ID, stored in
              <code class="filename">monitor_ids</code> table, and
              the database structure is now:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
rectime | id | mval | mmin | mmax
</pre>
                  </td>
                </tr>
              </table>this option is the best for large data but
              with always-changing parameter names (for example
              netflow data aquisition)
            </dd>

            <dt><span class="term">7,8 : averaged / raw modes for
            another ID-related structure</span></dt>

            <dd>
              <p>for each unique ID a separate table is kept with
              the data from that series only, the table name will
              be <code class="filename">UNIQUE_NAME_id</code> and
              the structure is</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
rectime | mval | mmin | mmax
</pre>
                  </td>
                </tr>
              </table>this option is the best one when the data
              series are constant in time, it works well with up to
              10000 table names (10000 unique ids if you have a
              single table writer, 5000 unique ids if you define 2
              separate writers and so on).
            </dd>
          </dl>
        </div>

        <div class="important" style=
        "margin-left: 0.5in; margin-right: 0.5in;">
          <h3 class="title">Important</h3>

          <p>Modes 7 and 8 only work with PostgreSQL because of
          some stored procedures needed to improve response
          times.</p>
        </div>

        <p>For a large data repository we would recommend using
        PostgreSQL with something like:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
lia.Monitor.Store.TransparentStoreFast.web_writes = 2

lia.Monitor.Store.TransparentStoreFast.writer_0.total_time=31536000
lia.Monitor.Store.TransparentStoreFast.writer_0.samples=525600
lia.Monitor.Store.TransparentStoreFast.writer_0.table_name=monitor_1y_1min
lia.Monitor.Store.TransparentStoreFast.writer_0.descr=1y 1min
lia.Monitor.Store.TransparentStoreFast.writer_0.writemode=7

lia.Monitor.Store.TransparentStoreFast.writer_1.total_time=31536000
lia.Monitor.Store.TransparentStoreFast.writer_1.samples=5256
lia.Monitor.Store.TransparentStoreFast.writer_1.table_name=monitor_1y_100min
lia.Monitor.Store.TransparentStoreFast.writer_1.descr=1y 100min
lia.Monitor.Store.TransparentStoreFast.writer_1.writemode=7
</pre>
            </td>
          </tr>
        </table>

        <p>We define 2 separate writers with different averaging
        intervals (1min and 100min) so the repository can use the
        proper one in different situations. For example when
        plotting a 1-hour chart it will choose the 1min table, but
        if you plot a 6-months chart it will choose the 100min one,
        reducing the number of operations needed to plot that data.
        A single writer would either limit the data resolution or
        response speed, more than 2 writers add much overhead and
        supplemental disk usage without much benefit.</p>

        <p>Whatever storage type you use there is a memory buffer
        that is used in parallel with the disk storage (if any).
        Its size depends on the maximum JVM memory (-Xmx parameter)
        and is dinamically adjusted so that it doesn't use all of
        the available memory. When making a history query this is
        the first source of data, if more data is needed then a
        separate database query is executed to retrieve the
        remaining interval. In a repository you can see the current
        buffer status in <code class=
        "filename">http://......./info.jsp</code>, look for
        something like:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
Data cache: values: 252275/262144 (max 262144), time frame: 2:13:29, served 
requests: 16490
</pre>
            </td>
          </tr>
        </table>this tells you the number of values in the buffer,
        what period of time it holds and how many requests were
        served from this buffer.
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "ml-farm-files-setup" id=
              "ml-farm-files-setup"></a>2.5.&nbsp;How to setup the
              configuration files for your site</h2>
            </div>
          </div>
        </div>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              <p>Go to <code class=
              "filename">"MonaLisa"/Service</code> directory and
              create a directory for your site (e.g <code class=
              "filename">MySite</code>). You may copy the
              configuration files from one of the available site
              directory (e.g.: those from the <code class=
              "filename">"MonaLisa"/Service/TEST</code> directory).
              You must include the following files in you new Farm
              (<code class="filename">ml.properties</code>,
              <code class="filename">db.conf.embedded</code> and
              <code class="filename">my_test.conf</code>)</p>
            </li>

            <li>
              <p>Edit the configuration file (<code class=
              "filename">my_site.conf</code>) to reflect the
              environment you want to monitor.</p>
            </li>

            <li>
              <p>Edit <code class="filename">ml.properties</code>
              if you would like to change the Lookup Discovery
              Services that will be used or if you would like to
              use another DB System.</p>
            </li>

            <li>
              <p>You may add a <code class=
              "filename">myIcon.gif</code> file with an icon of
              your organization in <code class=
              "filename">"MonaLisa"/Service/ml_dl</code>.</p>
            </li>
          </ul>
        </div>

        <p>The only script used to start/stop/restart "MonaLisa" is
        <code class="filename">ML_SER</code> from this directory.
        After you have done what is described in <a href=
        "#ml-farm-config" title=
        "2.3.&nbsp;The MonALISA Farm Configuration and Measured Parameters">
        Section&nbsp;2.3, &#8220;The MonALISA Farm Configuration
        and Measured Parameters&#8221;</a> section you can start
        using MonALISA:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
Service/CMD/ML_SER start
        
</pre>
            </td>
          </tr>
        </table>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "start-ml-service-from-initd" id=
              "start-ml-service-from-initd"></a>2.6.&nbsp;How to
              start a Monitoring Service from init.d</h2>
            </div>
          </div>
        </div>

        <p>Please set correctly <code class=
        "varname">MonaLisa_HOME</code> and <code class=
        "varname">MONALISA_USER</code> variables from
        <strong class="userinput"><code>${MonaLisa_HOME}/Service/CMD/MLD</code></strong>.</p>

        <div class="variablelist">
          <dl>
            <dt><span class="term">For 'Rehat like'</span></dt>

            <dd>
              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
#cp ${MonaLisa_HOME}/Service/CMD/MLD /etc/init.d 
#chkconfig --add MLD 
#chkconfig --level 345 MLD on 
              
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">For Debian</span></dt>

            <dd>
              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
#cp ${MonaLisa_HOME}/Service/CMD/MLD /etc/init.d 
#update-rc.d MLD start 80 3 4 5 . 
#update-rc.d MLD stop 86 3 4 5 .
              
</pre>
                  </td>
                </tr>
              </table>
            </dd>
          </dl>
        </div>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "start-ml-service-with-autoupdate" id=
              "start-ml-service-with-autoupdate"></a>2.7.&nbsp;How
              to start a Monitoring Service with Autoupdate</h2>
            </div>
          </div>
        </div>

        <p>This allows to automatically update your Monitoring
        Service. The cron script will periodically check for
        updates using a list of URLs. When a new version is
        published the system will check its digital signature and
        then will download the new distribution as a set of signed
        jar files. When this operation is completed the MonALISA
        service will restart automatically. The dependecies and the
        configurations related with the service are done in a very
        similar way like the Web Start technology.</p>

        <p>This functionality makes it very easy to maintain and
        run a MonALISA service. We recomnend to use it!</p>

        <p>In this case you should add <code class=
        "filename">"MonaLisa"/Service/CMD/CHECK_UPDATE</code> to
        the user's crontab that runs MonALISA. To edit your crontab
        use: <strong class="userinput"><code>$crontab
        -e</code></strong></p>

        <p>Add the following line:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
*/20 * * * * /&lt;path_to_your_MonaLisa&gt;/Service/CMD/CHECK_UPDATE
        
</pre>
            </td>
          </tr>
        </table>This would check for update every twenty minutes.
        It is resonable value that this value should be &gt;=
        twenty minutes. To check for update every 30 minutes add
        the following line instead of the one above.

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
*/30 * * * * /&lt;path_to_your_MonaLisa&gt;/Service/CMD/CHECK_UPDATE
        
</pre>
            </td>
          </tr>
        </table>

        <p>To disable autoupdate you cand edit the <code class=
        "filename">ml_env</code> file in <code class=
        "filename">"MonaLisa"/Service/CMD</code> and set
        <strong class=
        "userinput"><code>SHOULD_UPDATE="false"</code></strong>&gt;.
        It is no need to remove the script <code class=
        "filename">CHECK_UPDATE</code> from your crontab.</p>

        <p>Launch <strong class=
        "userinput"><code>"MonaLisa"/Service/CMD/ML_SER
        start</code></strong>. MonALISA should check for updates
        now.</p>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "ml-service-under-fiewall" id=
              "ml-service-under-fiewall"></a>2.8.&nbsp;Running
              MonALISA behind a firewall</h2>
            </div>
          </div>
        </div>

        <p>The MonALISA service has no problem now running behind a
        firewall because of the new proxy services that connect
        clients with services. If the proxy service cannot create
        the TCP connection with the farm service because of a
        firewall, then the farm starts the connection with the
        proxy.</p>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "writing-ml-modules" id=
              "writing-ml-modules"></a>2.9.&nbsp;Writing new
              Monitoring Modules</h2>
            </div>
          </div>
        </div>

        <p>New Monitoring modules can be easily developed. These
        modules may use SNMP requests or can simply run any script
        (locally or on a remote system) to collected the requested
        values. The mechanism to run these modules under
        independent threads, to perform the interaction with the
        operating system or to control a snmp session are inherited
        from a basic monitoring class. The user basically should
        only provide the mechanism to collect the values, to parse
        the output and to generate a result object. It is also
        required to provide the names of the parameters that are
        collected by this module.</p>

        <p>Creating a new module means writing a class that extends
        the <code class=
        "classname">lia.Monitor.monitor.cmdExec</code> class and
        implements <code class=
        "classname">lia.Monitor.monitor.MonitoringModule</code>
        interface.</p>

        <p>This interface has the following structure:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="programlisting">
    package lia.Monitor.monitor;

    public interface MonitoringModule extends lia.util.DynamicThreadPoll.SchJobInt {

    public  MonModuleInfo init( MNode node, String args ) ;
        public String[] ResTypes() ;
        public String   getOsName();
        public Object   doProcess() throws Exception ;

        public MNode getNode();

        public String getClusterName();
        public String getFarmName();

        public boolean isRepetitive() ;

        public String getTaskName();
        public MonModuleInfo getInfo();

    }
</pre>
            </td>
          </tr>
        </table>The <code class="function">doProcess</code> is
        actuly the function that collects and returns the results.
        Usually the return type is a Vector of <code class=
        "classname">lia.Monitor.monitor.Result</code> objects. It
        can also be a simple <code class="classname">Result</code>
        object.

        <p>The <code class="function">init</code> function
        initializes the useful information for the module, like the
        cluster that contains the monitoring nodes, the farm and
        the command line parameters for this module. This function
        is the first called when the farm loads the module.</p>

        <p>The <code class="function">isRepetitive</code> function
        tells if the module has to collect results only once or
        repe-titively. The return values is the <code class=
        "varname">isRepetitive</code> module boolean variable. If
        true, then the module is called from time to time. The
        repetitive time is specified in the &lt;farm&gt;
        <code class="filename">.conf</code> file. If not there,
        then the default repetitive call time is 30s.</p>

        <p>The rest of functions returns different module
        information.</p>

        <p>Examples to generate new modules can be found in
        <code class=
        "filename">${MonaLisa_HOME}/Service/usr_code</code>.</p>

        <p>In <code class="filename">usr_code/MDS</code> is an
        example of writing the received values into MDS. This is
        done using a unix pipe to communicate between the
        dynamically loadable java module and the script performing
        the update into the LDAP server.</p>

        <p>Another simple example which simply print all the values
        on sysout can be found on <code class=
        "filename">usr_code/SimpleWriter</code>.</p>

        <p>Another example to write the values into UDP sockets is
        in <code class="filename">usr_code/UDPWriter</code>.</p>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "writing-ml-filters" id=
              "writing-ml-filters"></a>2.10.&nbsp;Writing new
              Filters</h2>
            </div>
          </div>
        </div>

        <p>Filters allow to dynamically create any new type of
        derived value from the collected values. Es an example it
        allow to evaluate the integrated traffic over last n
        minutes, or the number of nodes for which the load is less
        than x. Filters may also send an email to a list or SMS
        messages when predefined complex condition occur. These
        filters are executed in independent threads and allow any
        client to register for its output. They may be used to help
        application to react on certain conditions occur, or to
        help in presenting global values for large computing
        facilities.</p>
      </div>
    </div>

    <div class="chapter" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="ml-features" id=
            "ml-features"></a>Chapter&nbsp;3.&nbsp;MonALISA
            Features</h2>
          </div>
        </div>
      </div>

      <div class="toc">
        <p><b>Table of Contents</b></p>

        <dl>
          <dt><span class="sect1"><a href=
          "#remote-control-and-config-of-apps">3.1. Remote Control
          and Configuration of Applications</a></span></dt>

          <dd>
            <dl>
              <dt><span class="sect2"><a href=
              "#general-description">3.1.1. General
              description</a></span></dt>

              <dt><span class="sect2"><a href="#id2839538">3.1.2.
              Client-Server Protocol</a></span></dt>

              <dt><span class="sect2"><a href=
              "#writing-app-modules">3.1.3. Writing New Modules for
              AppControl</a></span></dt>

              <dt><span class="sect2"><a href="#id2840694">3.1.4.
              Remote Interface for MonALISA Modules
              Management</a></span></dt>

              <dt><span class="sect2"><a href="#id2840712">3.1.5.
              Clients for the Application Control
              Interface</a></span></dt>
            </dl>
          </dd>

          <dt><span class="sect1"><a href="#ws-for-ml">3.2. Web
          Services for MonALISA</a></span></dt>

          <dd>
            <dl>
              <dt><span class="sect2"><a href=
              "#ws-description">3.2.1. Service
              description</a></span></dt>

              <dt><span class="sect2"><a href=
              "#ws-implementation">3.2.2. Service
              implementation</a></span></dt>

              <dt><span class="sect2"><a href=
              "#ws-client-examples">3.2.3. Clients Examples for
              MLWebService</a></span></dt>
            </dl>
          </dd>
        </dl>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "remote-control-and-config-of-apps" id=
              "remote-control-and-config-of-apps"></a>3.1.&nbsp;Remote
              Control and Configuration of Applications</h2>
            </div>
          </div>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="general-description" id=
                "general-description"></a>3.1.1.&nbsp;General
                description</h3>
              </div>
            </div>
          </div>

          <p>MonALISA Service is not just a monitoring tool.
          Starting with this version, it has incorporated an
          Application Control Interface (AppControl) that allows
          the farm administrator to remotely start, stop, restart
          and configure different applications. This service starts
          automatically when the MonALISA service starts.</p>

          <p><em class="emphasis">The security part</em> is
          important for this remote administration interface. All
          the communication between clients and server is done over
          SSL. The server has a keystore with the clients' public
          keys, so only the administrators can access this
          application.</p>

          <p>For each controlled application it must exist a
          corresponding module. Each module can have multiple
          instances with <span><strong class=
          "emphasis">different</strong></span> configuration
          files.</p>

          <p>When a module is loaded you must specify a
          <span><strong class="emphasis">unique</strong></span>
          file name which will store the specified modules
          configuration. After that, you must correctly configure
          the module for working properly.</p>

          <p>New modules can be added at any time by uploading a
          <code class="filename">.jar</code> file with classes that
          correspond with the module functionality and conform to a
          given standard. For more details, please see <a href=
          "#writing-app-modules" title=
          "3.1.3.&nbsp;Writing New Modules for AppControl">Section&nbsp;3.1.3,
          &#8220;Writing New Modules for AppControl&#8221;</a>
          section. The upload of the new module can be easily done
          from the client interface.</p>

          <p>The AppControl has some default module:</p>

          <div class="itemizedlist">
            <ul type="disc">
              <li>
                <p><span><strong class=
                "emphasis">Apache</strong></span> module lets you
                start, stop and configure Apache web server
                remotely.</p>
              </li>

              <li>
                <p><span><strong class=
                "emphasis">Bash</strong></span> module lets you
                execute commands remotely.</p>
              </li>

              <li>
                <p><span><strong class=
                "emphasis">Proc</strong></span> module is for
                browsing the <code class="filename">/proc</code>
                directory.</p>
              </li>

              <li>
                <p><span><strong class=
                "emphasis">MonALISA</strong></span> lets you
                remotely configure and execute MonALISA
                service.</p>
              </li>
            </ul>
          </div>

          <p>There are two <em class="emphasis">clients</em> that
          can be used: a graphical one incorporated in the MonALISA
          Client GUI, and a command line one.</p>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="id2839538" id=
                "id2839538"></a>3.1.2.&nbsp;Client-Server
                Protocol</h3>
              </div>
            </div>
          </div>

          <p>The protocol is a text based, request-response one.
          The server messages have one of the following format:</p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
+OK
&lt;lines to be parsed by the client as response&gt;
.
</pre>
              </td>
            </tr>
          </table>or

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
-ERR &lt;error message&gt;
</pre>
              </td>
            </tr>
          </table>so the server responses starts with +OK in case
          of a correct execution of the client request, or with ERR
          in case of an error message. If the response was positive
          (i.e. +OK), then the client has to read the actual
          response until he receives a single dot on a line. If the
          original output contained a single dot on a single line,
          then this dot is transformed in two dots by the server,
          like .. instead of . .

          <p>Many of the commands parameters and output strings are
          encoded using URLEncoder with UTF-8. Whenever you will
          see <em class="emphasis">enc(something)</em> it means
          that <em class="emphasis">something</em> is encoded using
          this encoder.</p>

          <p>The set of commands that the server can process
          are:</p>

          <div class="itemizedlist">
            <ul type="disc">
              <li>
                <p><span><strong class=
                "emphasis">availablemodules</strong></span> - lists
                all the available modules on the server, one per
                line.</p>
              </li>

              <li>
                <p><span><strong class=
                "emphasis">loadedmodules</strong></span> - lists
                all the loaded modules on the server, one per
                line.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">deletemodule
                enc(&lt;module_name&gt;)
                enc(&lt;configuration_file&gt;)</strong></span> -
                when receiving this command, the server will delete
                the module with <em class=
                "emphasis">&lt;module_name&gt;</em> name and with
                the configuration file <em class=
                "emphasis">&lt;configuration_file&gt;</em> from the
                loaded modules.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">createmodule
                enc(&lt;module_name&gt;)
                enc(&lt;configuration_file&gt;)</strong></span> -
                receiving this command, the server will add a new
                module with name <em class=
                "emphasis">&lt;module_name&gt;</em> and with
                configuration file name <em class=
                "emphasis">&lt;configuration_file&gt;</em> to the
                list of loaded modules.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">start
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)</strong></span> - this
                command starts the module with <em class=
                "emphasis">&lt;module_name&gt;</em> name and with
                configuration file <em class=
                "emphasis">&lt;configuration_file&gt;</em>.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">stop
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)</strong></span> - this
                command stops the module with <em class=
                "emphasis">&lt;module_name&gt;</em> name and with
                configuration file <em class=
                "emphasis">&lt;configuration_file&gt;</em>.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">restart
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)</strong></span> - this
                command restarts the module with <em class=
                "emphasis">&lt;module_name&gt;</em> name and with
                configuration file <em class=
                "emphasis">&lt;configuration_file&gt;</em>.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">status
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)</strong></span> - this
                command returns the status of the module with
                <em class="emphasis">&lt;module_name&gt;</em> name
                and with configuration file <em class=
                "emphasis">&lt;configuration_file&gt;</em>. "0"
                means that the module is stopped, "1" means that
                the module is running, and "2" means that the satus
                of the module is unknown.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">info
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)</strong></span> - this
                command will return the configuration file
                <em class=
                "emphasis">&lt;configuration_file&gt;</em> of the
                module <em class=
                "emphasis">&lt;module_name&gt;</em> packed as an
                XML response. The XML response looks like this:</p>

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="screen">
&lt;config app=ApplicationName&gt;
  &lt;file name=AppConfigurationFileName&gt;
    &lt;key name=ConfigurationKey value=Value line=N read=true|false write=true|false /&gt;
    &lt;section name=ConfigurationSection value=Value line=N read=true|false write=true|false
        ......
      Other keys in this section
        ......
    &lt;/section&gt;
  &lt;/file&gt;
&lt;/config&gt;
</pre>
                    </td>
                  </tr>
                </table>For example let's look at a part of the XML
                for Apache's <code class=
                "filename">httpd.conf</code>:

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="screen">
&lt;config app="Apache"&gt;
  &lt;file name="httpd.conf"&gt;
    &lt;key name="ServerType" value="ceva" line="51" read="true" write="true"/&gt;
    &lt;key name="ServerRoot" value="%22%2Fusr%22" line="62" read="true" write="true"/&gt;
            ...
    &lt;section name="IfModule" value="mod_mime_magic.c" line="506" read="true" write="true"&gt;
      &lt;key name="MIMEMagicFile" value="%2Fetc%2Fapache%2Fmagic" line="507" read="true" write="true"/&gt;
    &lt;/section&gt;
            ...
    &lt;section name="VirtualHost" value="*" line="1010" read="true" write="true"&gt;
      &lt;key name="SeverName" value="localhost" line="1011" read="true" write="true"/&gt;
    &lt;/section&gt;
  &lt;/file&gt;
&lt;/config&gt;
</pre>
                    </td>
                  </tr>
                </table>
              </li>

              <li>
                <p><span><strong class="emphasis">exec
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)
                enc(&lt;command&gt;)</strong></span> - this command
                returns execution results of the command <em class=
                "emphasis">&lt;command&gt;</em> on the module
                <em class="emphasis">&lt;module_name&gt;</em> with
                configuration file <em class=
                "emphasis">&lt;configuration_file&gt;</em>. For
                example, execution the <strong class=
                "userinput"><code>ls -l</code></strong> command on
                the bash module makes sense.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">update
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)
                enc(&lt;update_comm&gt;)</strong></span> - *</p>
              </li>

              <li>
                <p><span><strong class="emphasis">getconfig
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;)</strong></span> - this
                command returns the configuration file of the
                module <em class=
                "emphasis">&lt;module_name&gt;</em> with
                configuration file name <em class=
                "emphasis">&lt;configuration_file&gt;</em>.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">updateconfig
                enc(&lt;module_name&gt; :
                &lt;configuration_file&gt;) enc(&lt;configuration
                file content&gt;)</strong></span> - this command
                will modify the content of the configuration file
                for module <em class=
                "emphasis">&lt;module_name&gt;</em> with <em class=
                "emphasis">&lt;configuration file
                content&gt;</em>.</p>
              </li>

              <li>
                <p><span><strong class="emphasis">upload
                enc(&lt;file_name&gt;) enc(&lt;binary file
                content&gt;)</strong></span> - this command creates
                a new available module with name <em class=
                "emphasis">&lt;file_name&gt;</em> uploading the
                <code class="filename">.jar</code> archive with
                content <em class="emphasis">&lt;binary file
                content&gt;</em>.</p>
              </li>
            </ul>
          </div>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="writing-app-modules" id=
                "writing-app-modules"></a>3.1.3.&nbsp;Writing New
                Modules for AppControl</h3>
              </div>
            </div>
          </div>

          <div class="sect3" lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a name="id2840013" id=
                  "id2840013"></a>3.1.3.1.&nbsp;The <code class=
                  "classname">lia.app.AppInt</code> interface</h4>
                </div>
              </div>
            </div>

            <p>All the modules must implement the <code class=
            "classname">lia.app.AppInt</code> interface and must be
            packaged in <code class="filename">.jar</code> files
            that exactly respect the package structure.</p>

            <p>The definition for <code class=
            "classname">lia.app.AppInt</code> is:</p>

            <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
            border="0" bgcolor="#E0E0E0" width="90%">
              <tr>
                <td>
                  <pre class="programlisting">
package lia.app;

public interface AppInt {

    public boolean start();
    public boolean stop();
    public int     status();
    public String  info();
    public String  exec(String sCmd);
    public boolean update(String sUpdate);
    public boolean update(String sUpdate[]);
    
    public String  getConfiguration();
    public boolean updateConfiguration(String s);

    public boolean init(String sPropFile);
    
    public String  getName();
    public String  getConfigFile();

} // end of interface AppInt
</pre>
                </td>
              </tr>
            </table>

            <div class="variablelist">
              <dl>
                <dt><span class="term"><code class=
                "function">start()</code></span></dt>

                <dd>
                  <p>This function should start the service and
                  return <em class="emphasis">true</em> if the
                  service could be started and <em class=
                  "emphasis">false</em> if the service could not be
                  started.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">stop()</code></span></dt>

                <dd>
                  <p>This function should stop the service and
                  return <em class="emphasis">true</em> if the
                  service could be stopped and <em class=
                  "emphasis">false</em> if the service could not be
                  stopped.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">status()</code></span></dt>

                <dd>
                  <p>Returns one of the following codes:</p>

                  <div class="itemizedlist">
                    <ul type="disc">
                      <li>
                        <p><code class=
                        "classname">lia.app.AppUtils.APP_STATUS_STOPPED</code>
                        (0) - the application is not running</p>
                      </li>

                      <li>
                        <p><code class=
                        "classname">lia.app.AppUtils.APP_STATUS_RUNNING</code>
                        (1) - the application is running</p>
                      </li>

                      <li>
                        <p><code class=
                        "classname">lia.app.AppUtils.APP_STATUS_UNKNOWN</code>
                        (2) - application status could not be
                        determined</p>
                      </li>
                    </ul>
                  </div>
                </dd>

                <dt><span class="term"><code class=
                "function">info()</code></span></dt>

                <dd>
                  <p>Returns a string with the application
                  configuration files as an XML. See the examples
                  above to see how the XML looks like.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">exec(String)</code></span></dt>

                <dd>
                  <p>Executes the given command and returns the
                  output of the command. You can return null if the
                  application you are controlling does not accept
                  any user commands.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">update(String)</code></span></dt>

                <dd>
                  <p>Changes the application configuration files
                  according to the given argument. You should
                  implement the commands explained in the
                  Client-Server protocol document. The return value
                  must be true if the requested update could be
                  done or false if the configuration could not be
                  updated.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">update(String [])</code></span></dt>

                <dd>
                  <p>Executes a set of updates. It's implementation
                  might be as simple as:</p>

                  <table xmlns=
                  "http://www.w3.org/TR/xhtml1/transitional"
                  border="0" bgcolor="#E0E0E0" width="90%">
                    <tr>
                      <td>
                        <pre class="programlisting">
for (int i=0; i&lt;sUpdate.length; i++) update(sUpdate[i]);
</pre>
                      </td>
                    </tr>
                  </table>
                </dd>

                <dt><span class="term"><code class=
                "function">getConfiguration()</code></span></dt>

                <dd>
                  <p>Returns the content of the module's
                  configuration file as a string value. You should
                  use <code class=
                  "classname">lia.app.AppUtils.getConfig(Properties
                  prop, String sFile)</code></p>
                </dd>

                <dt><span class="term"><code class=
                "function">updateConfiguration(String)</code></span></dt>

                <dd>
                  <p>Replaces the content of the configuration file
                  with the given string. You should use
                  <code class="classname">lia.app.AppUtils.updateConfig(String
                  sFile, String sContent)</code></p>
                </dd>

                <dt><span class="term"><code class=
                "function">init(String)</code></span></dt>

                <dd>
                  <p>This function is called by the main program
                  when the module is loaded. The parameter is the
                  module's configuration file. You should use
                  <code class=
                  "classname">lia.app.AppUtils.getConfig(Properties
                  prop, String sFile)</code> to read the contents
                  of this file.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">getName()</code></span></dt>

                <dd>
                  <p>Should return the complete name of the module
                  to make sure that there is no conflict in
                  names.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">getConfigFile()</code></span></dt>

                <dd>
                  <p>Returns the configuration file name given as
                  parameter to <code class=
                  "function">init(String)</code>.</p>
                </dd>
              </dl>
            </div>
          </div>

          <div class="sect3" lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a name="id2840441" id=
                  "id2840441"></a>3.1.3.2.&nbsp;The <code class=
                  "classname">lia.app.AppUtils</code> class</h4>
                </div>
              </div>
            </div>

            <p>This class offers functions that will ease the
            writing of new modules. We strongly encourage you to
            use these functions so whenever there is a change in
            the main code all the modules will keep working.</p>

            <p>The classes public, static functions are:</p>

            <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
            border="0" bgcolor="#E0E0E0" width="90%">
              <tr>
                <td>
                  <pre class="programlisting">
    String enc(String s);
    String dec(String s);
    String getOutput(String s);
    String getOutput(String vs[]);
    java.util.Vector getLines(String s);
    void getConfig(Properties prop, String sFile);
    boolean updateConfig(String sFile, String sContent);
</pre>
                </td>
              </tr>
            </table>

            <div class="variablelist">
              <dl>
                <dt><span class="term"><code class=
                "function">enc(String s)</code></span></dt>

                <dd>
                  <p>Returns the URLEncoded value of the given
                  parameter using the UTF-8 charset.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">dec(String s)</code></span></dt>

                <dd>
                  <p>Returns the URLDecoded value of the given
                  parameter using the UTF-8 charset.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">getOutput(String s)</code></span></dt>

                <dd>
                  <p>Returns the output generated by the given
                  system command or null if the command could not
                  be executed. You can separate the parameters by
                  spaces and you can enclose a large parameter
                  (with spaces) between " characters. This function
                  only builds a <code class=
                  "classname">String[]</code> of the command tokens
                  and calls <code class="function">getOutput(String
                  vs[])</code>.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">getOutput(String
                vs[])</code></span></dt>

                <dd>
                  <p>Returns the output generated by the given
                  system command or null if the command could not
                  be executed.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">getLines(String s)</code></span></dt>

                <dd>
                  <p>Returns a <code class=
                  "classname">java.util.Vector</code> having each
                  line of s as an element. It saves you from
                  parsing the output of a command or the content of
                  a text configuration file.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">getConfig(Properties prop, String
                sFile)</code></span></dt>

                <dd>
                  <p>Loads the contents of the sFile file from
                  <code class="filename">conf/</code> folder into
                  the prop <code class=
                  "classname">Properties</code> object. You should
                  use this method to load the configuration file
                  instead of directly using the <code class=
                  "filename">conf/sFile</code> file.</p>
                </dd>

                <dt><span class="term"><code class=
                "function">updateConfig(String sFile, String
                sContent)</code></span></dt>

                <dd>
                  <p>Writes the value of <code class=
                  "varname">sContent</code> into <code class=
                  "varname">sFile</code>. You should use this
                  method instead of directly writing the string to
                  <code class="filename">conf/sFile</code> file
                  because the configuration files' location might
                  change in the future.</p>
                </dd>
              </dl>
            </div>
          </div>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="id2840694" id=
                "id2840694"></a>3.1.4.&nbsp;Remote Interface for
                MonALISA Modules Management</h3>
              </div>
            </div>
          </div>

          <p>As an administrator, you have also access for modules
          management in MonALISA Service. Using this interface,
          which is also integrated with the MonALISA Client, you
          can start, stop, restart or upload a module in MonALISA
          Service.</p>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="id2840712" id=
                "id2840712"></a>3.1.5.&nbsp;Clients for the
                Application Control Interface</h3>
              </div>
            </div>
          </div>

          <p>There are two clients: <em class="emphasis">a
          graphical one</em> and <em class="emphasis">a command
          line one</em>.</p>

          <p>The simple command line client has a command,
          <span><strong class="emphasis">help</strong></span> which
          shows all the available commands and how to use them. For
          details, please see <a href="#general-description" title=
          "3.1.1.&nbsp;General description">Section&nbsp;3.1.1,
          &#8220;General description&#8221;</a>.</p>

          <p>The graphical interface is integrated in the MonALISA
          client, but, for accessing it, you must have the right
          keystore. It presents Application Control server commands
          in a nice and friendly way.</p>
        </div>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "ws-for-ml" id="ws-for-ml"></a>3.2.&nbsp;Web Services
              for MonALISA</h2>
            </div>
          </div>
        </div>

        <p>A simple Web Service is integrated with the MonALISA
        service, as well with the MonALISA Repository. The Web
        service, "MLWebService", provides an interface for
        publishing the monitoring data using a WSDL/SOAP
        technology. In this way, any client can connect and receive
        selected monitoring data.</p>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ws-description" id=
                "ws-description"></a>3.2.1.&nbsp;Service
                description</h3>
              </div>
            </div>
          </div>

          <p>The service offers a single port type with three
          operations: <code class="function">getValues</code>,
          <code class="function">getConfiguration</code> and
          <code class="function">getLatestConfiguration</code>.</p>

          <div class="itemizedlist">
            <ul type="disc">
              <li>
                <p>the <code class="function">getValues</code>
                operation interrogates the database and gets all
                the parameter values for the farm, the cluster, the
                node and the parameter name specified as arguments.
                The time when the parameter(s) was registered in
                the database must be between two moments of time
                (fromTime and toTime) also specified as operation
                input. The return type is a complex schema type, an
                array of results containing all the values taken
                from the database.</p>
              </li>

              <li>
                <p>the <code class=
                "function">getConfiguration</code> operation
                interrogates the database and gets all
                configurations of all farms that were registered in
                the database between two limits of time (from time
                and to time) given as input. The return type is a
                complex schema type, an array of configurations
                that were found in the database that matched the
                constraints .</p>
              </li>

              <li>
                <p>the <code class=
                "function">getLatestConfiguration</code> operation
                interrogates the database and returns the last
                configuration received in the database for a given
                farm. It receives as input a string, the farm name.
                It returns a complex schema type that represents
                the configuration.</p>
              </li>
            </ul>
          </div>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ws-implementation" id=
                "ws-implementation"></a>3.2.2.&nbsp;Service
                implementation</h3>
              </div>
            </div>
          </div>

          <p>The web service application was developed using Apache
          Axis (See <a href="http://ws.apache.org/axis" target=
          "_top">http://ws.apache.org/axis</a>).</p>

          <p>The interface of the service contains the following
          functions:</p>

          <div class="variablelist">
            <dl>
              <dt><span class="term"><code class=
              "function">Result[] getValues (String farmName,
              String clusterName, String nodeName, String
              parameterName, long fromTime, long
              toTime);</code></span></dt>

              <dd>
                <p>This function can be called in two ways:</p>

                <div class="itemizedlist">
                  <ul type="disc">
                    <li>
                      <p>specifying negative values for times. For
                      example, if the call is</p>

                      <table xmlns=
                      "http://www.w3.org/TR/xhtml1/transitional"
                      border="0" bgcolor="#E0E0E0" width="90%">
                        <tr>
                          <td>
                            <pre class="programlisting">
getValues( "*", "*", "*", "*",-3600000,0)
</pre>
                          </td>
                        </tr>
                      </table>the service will return all the
                      values registered in the database in the last
                      hour.
                    </li>

                    <li>
                      <p>specifying absolute values for time. For
                      example, if the call is</p>

                      <table xmlns=
                      "http://www.w3.org/TR/xhtml1/transitional"
                      border="0" bgcolor="#E0E0E0" width="90%">
                        <tr>
                          <td>
                            <pre class="programlisting">
getValues ("*", "*", "*", "*", 1060400000000, 1065000000000)
</pre>
                          </td>
                        </tr>
                      </table>the service will return all the
                      values registered in the database with the
                      registration time between the two values
                      specified in milliseconds.
                    </li>
                  </ul>
                </div>

                <p>The Result class is a Bean class and has the
                following description:</p>

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="programlisting">
public class Result {
    private String farmName;      // the farm name that contains the parameters 
    private String clusterName;   // the cluster name that contains the parameters 
    private String  nodeName ;    // the node name that contains the parameters 
    private String[] param_name ; // the parameters names
    private double[] param;       // the parameters values
    private long time;            // the absolute time in milliseconds when this value was   
                                  // registered in the database
    ............                  // get/set functions
}
</pre>
                    </td>
                  </tr>
                </table>
              </dd>

              <dt><span class="term"><code class=
              "function">WSConf[] getConfiguration (long fromTime,
              long toTime);</code></span></dt>

              <dd>
                <p>The times specified for this function are
                absolute moments of time in milliseconds.</p>

                <p>The WSConf is a Bean class and has the following
                description:</p>

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="programlisting">
public class WSConf {
    private WSFarm wsFarm; // the farm that had this configuration
    private long confTime; // the time when this configuration was registered in 
                           // the database
    .............          // get/set functions
} 
                  
</pre>
                    </td>
                  </tr>
                </table>the java class that describes a farm:

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="programlisting">
public class WSFarm {
    private String farmName;         // the name of the farm
    private WSCluster[] clusterList; // the clusters of this farm
    ..........                       // get/set functions
}
</pre>
                    </td>
                  </tr>
                </table>the java class that describes a cluster:

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="programlisting">
public class WSCluster {
    private String clusterName; // the name of the cluster
    private WSNode[] nodeList ; // the nodes contained in this cluster
    ..........                  // get/set functions
}
</pre>
                    </td>
                  </tr>
                </table>the java class that describes a node:

                <table xmlns=
                "http://www.w3.org/TR/xhtml1/transitional" border=
                "0" bgcolor="#E0E0E0" width="90%">
                  <tr>
                    <td>
                      <pre class="programlisting">
public class WSNode {
    private nodeName ;        // the node name
    private String paramList; // the list of parameters for this node
    .........                 // get/set functions
}
</pre>
                    </td>
                  </tr>
                </table>
              </dd>

              <dt><span class="term"><code class=
              "function">WSConf[] getLatestConfiguration (String
              farm)</code></span></dt>

              <dd>
                <p>returns the latest configurations received in
                the database for all farms (farm="*") or returns
                the latest configuration for a specified farm.</p>
              </dd>
            </dl>
          </div>
        </div>

        <div class="sect2" lang="en">
          <div class="titlepage">
            <div>
              <div>
                <h3 class="title"><a name="ws-client-examples" id=
                "ws-client-examples"></a>3.2.3.&nbsp;Clients
                Examples for MLWebService</h3>
              </div>
            </div>
          </div>

          <p>An archive with Java and Perl examples of simple
          MLWebService clients example can be downloaded from
          <a href="http://monalisa.cacr.caltech.edu/" target=
          "_top">http://monalisa.cacr.caltech.edu/</a>. These
          examples shows you how to interrogate the web service
          from MonALISA and get monitoring data using the SOAP
          protocol.</p>

          <div class="sect3" lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a name="id2841119" id=
                  "id2841119"></a>3.2.3.1.&nbsp;MLWebService
                  clients examples presentation</h4>
                </div>
              </div>
            </div>

            <p>The client examples presented here can interrogate
            both the MLWebService from the Repository and the
            MLWebService from the MonALISA service. There are
            examples for <span><strong class=
            "emphasis">Java-Axis</strong></span>,
            <span><strong class="emphasis">WSIF</strong></span> and
            <span><strong class=
            "emphasis">Perl</strong></span>.</p>
          </div>

          <div class="sect3" lang="en">
            <div class="titlepage">
              <div>
                <div>
                  <h4 class="title"><a name="id2841156" id=
                  "id2841156"></a>3.2.3.2.&nbsp;Examples archive
                  structure</h4>
                </div>
              </div>
            </div>

            <p>The sources of the clients examples are located in
            the <code class="filename">WS-Clients</code> directory.
            There are special subdirectories in it (<code class=
            "filename">Java-Axis</code>, <code class=
            "filename">Perl</code>, <code class=
            "filename">Wsif</code>), each containing clients
            developed using different libraries
            (<span><strong class="emphasis">Apache
            Axis</strong></span>, <span><strong class=
            "emphasis">Soap:Lite</strong></span> and
            <span><strong class="emphasis">Apache
            Wsif</strong></span>). Every client example calls a
            function of the MLWebService and is located in a
            directory having the name of the called function of the
            service. The source of every example is called
            <span><strong class="emphasis">Client</strong></span>
            (<code class="filename">Client.java</code> or
            <code class="filename">Client.pl</code>). There are
            special scripts in each directory for automating the
            installation of used libraries, the compilation and
            execution of each client:</p>

            <div class="itemizedlist">
              <ul type="disc">
                <li>
                  <p>for the examples developed in Java (Axis or
                  WSIF) each example contains the following
                  scripts</p>

                  <div class="itemizedlist">
                    <ul type="circle">
                      <li>
                        <p>the <code class=
                        "filename">generate_classes</code> script
                        uses the WSDL2Java tool for generating the
                        client used classes;</p>
                      </li>

                      <li>
                        <p>the <code class=
                        "filename">compile_classes</code> script
                        compiles the client classes;</p>
                      </li>

                      <li>
                        <p>the <code class=
                        "filename">run_client</code> script
                        executes the example.</p>
                      </li>
                    </ul>
                  </div>
                </li>

                <li>
                  <p>for the example developed in Perl, there were
                  used special modules (<span><strong class=
                  "emphasis">Soap::Lite</strong></span> and
                  <span><strong class=
                  "emphasis">Time:HiRes</strong></span>). This
                  modules are automatically installed using the
                  <code class="filename">install_soap_lite</code>
                  and <code class=
                  "filename">install_time_hires</code> scripts
                  located in the Perl directory.</p>
                </li>
              </ul>
            </div>

            <p>For details see the <code class=
            "filename">Readme</code> files from every example
            directory.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="chapter" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="proxy-service" id=
            "proxy-service"></a>Chapter&nbsp;4.&nbsp;Proxy
            Service</h2>
          </div>
        </div>
      </div>

      <div class="toc">
        <p><b>Table of Contents</b></p>

        <dl>
          <dt><span class="sect1"><a href="#id2841352">4.1. Why
          this proxy?</a></span></dt>

          <dt><span class="sect1"><a href="#id2841414">4.2. Where
          are these proxy services? The communication with
          clients</a></span></dt>
        </dl>
      </div>

      <p>This service intermediates communication between MonALISA
      Service and its clients. It registers as a Jini client being,
      in this way, found by clients. It also finds farms in given
      lookup services and connects with them. Clients send request
      messages to the known proxy, which forwards them to the
      specified farm.</p>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "id2841352" id="id2841352"></a>4.1.&nbsp;Why this
              proxy?</h2>
            </div>
          </div>
        </div>

        <p>This service was introduced because of the following
        reasons:</p>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              <p>it limits the number of TCP connections to farms.
              Without this proxy, every client starts its TCP
              connection with every found farm. With a big number
              of clients, a farm could be overloaded. But having a
              number of proxy services, the number of farm clients
              is much greater</p>
            </li>

            <li>
              <p>the number of messages between farms and clients
              decreases. For example, without this proxy, every
              client received from every farm the same filter
              messages, but on its TCP connection. Using the proxy
              service, this kind of messages are transmitted only
              between the farms and the proxy service and then
              spread by it to all known clients interested in those
              filters.</p>
            </li>

            <li>
              <p>the MonALISA service can now run behind a firewall
              without any problem. If the proxy cannot connect to
              the found farm, then the farm initiates the TCP
              connection with the proxy announcing its
              presence.</p>
            </li>
          </ul>
        </div>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "id2841414" id="id2841414"></a>4.2.&nbsp;Where are
              these proxy services? The communication with
              clients</h2>
            </div>
          </div>
        </div>

        <p>These proxy services run on different machines and
        register with known lookup services. The client finds these
        services and, getting the proxys attributes, makes a
        decision on which to choose. After choosing one, the
        communication with farms is intermediated by this one.</p>

        <p>If the connection with the chosen proxy has died, the
        client tries to find another one and initiates a new dialog
        with farms through the new one.</p>
      </div>
    </div>

    <div class="chapter" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="ml-repositories" id=
            "ml-repositories"></a>Chapter&nbsp;5.&nbsp;MonALISA
            Repositories</h2>
          </div>
        </div>
      </div>

      <div class="toc">
        <p><b>Table of Contents</b></p>

        <dl>
          <dt><span class="sect1"><a href="#id2841471">5.1.
          Currently available repositories</a></span></dt>
        </dl>
      </div>

      <p>A Repository is actually a client to farm services that
      collects data from these services, has dedicated procedures
      to compress old values and to mediate them and stores the
      results locally into a relational database (MySQL).</p>

      <p>These data are used by the Repository to present a WEB
      synthetic view of the large distributed system. A servlet
      engine is used to present historical and real time values in
      a flexible way. The same mechanism is used to offer access to
      this information from mobile phones using the Wireless Access
      Protocol (WAP).</p>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "id2841471" id="id2841471"></a>5.1.&nbsp;Currently
              available repositories</h2>
            </div>
          </div>
        </div>

        <div class="variablelist">
          <dl>
            <dt><span class="term">WAP</span></dt>

            <dd>
              <p>Please set this address into your mobile
              phone:</p>

              <p><a href=
              "http://monalisa.cacr.caltech.edu:8080/wap/index.wml"
              target=
              "_top">http://monalisa.cacr.caltech.edu:8080/wap/index.wml</a></p>

              <p>It provides real-time information about:</p>

              <div class="itemizedlist">
                <ul type="disc">
                  <li>
                    <p><span><strong class=
                    "emphasis">US-CMS</strong></span> production
                    farms</p>
                  </li>

                  <li>
                    <p>Wide Area Network Traffic from
                    <span><strong class=
                    "emphasis">CERN</strong></span> and
                    <span><strong class="emphasis">PoP in
                    Chicago</strong></span>.</p>
                  </li>
                </ul>
              </div>
            </dd>

            <dt><span class="term">WEB</span></dt>

            <dd>
              <p><a href=
              "http://monalisa.cacr.caltech.edu:8080/index.html"
              target=
              "_top">http://monalisa.cacr.caltech.edu:8080/index.html</a></p>

              <p>Provides information about:</p>

              <div class="itemizedlist">
                <ul type="disc">
                  <li>
                    <p><span><strong class=
                    "emphasis">US-CMS</strong></span> production
                    farms: Farms Usage, Masters Load, IO
                    Traffic.</p>
                  </li>

                  <li>
                    <p>Wide Area Network Traffic from
                    <span><strong class=
                    "emphasis">CERN</strong></span> and
                    <span><strong class=
                    "emphasis">Chicago</strong></span>.</p>
                  </li>
                </ul>
              </div>
            </dd>
          </dl>
        </div>

        <p>Please see the <a href=
        "http://monalisa.cacr.caltech.edu/" target=
        "_top">http://monalisa.cacr.caltech.edu/</a> for other
        available repositories.</p>
      </div>
    </div>

    <div class="chapter" lang="en">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a name="other-related-topics" id=
            "other-related-topics"></a>Chapter&nbsp;6.&nbsp;Other
            Related Topics</h2>
          </div>
        </div>
      </div>

      <div class="toc">
        <p><b>Table of Contents</b></p>

        <dl>
          <dt><span class="sect1"><a href="#how-to-test-snmp">6.1.
          How to test SNMP</a></span></dt>
        </dl>
      </div>

      <div class="sect1" lang="en">
        <div class="titlepage">
          <div>
            <div>
              <h2 class="title" style="clear: both"><a name=
              "how-to-test-snmp" id=
              "how-to-test-snmp"></a>6.1.&nbsp;How to test
              SNMP</h2>
            </div>
          </div>
        </div>

        <p>You can test the values provided by the snmpd demon
        (based on how it is configured) by using:</p>

        <div class="variablelist">
          <dl>
            <dt><span class="term">legacy ucd-snmp</span></dt>

            <dd>
              <p>Use the following command:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
$ snmpwalk [-p port_no] system_name community OID
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">net-snmp</span></dt>

            <dd>
              <p>Use the following command:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
$ snmpwalk -v2c -c community system_name[:port_no] OID
</pre>
                  </td>
                </tr>
              </table>
            </dd>
          </dl>
        </div>

        <div class="example">
          <a name="id2841730" id="id2841730"></a>

          <p class="title"><b>Example&nbsp;6.1.&nbsp;SNMP</b></p>

          <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
          border="0" bgcolor="#E0E0E0" width="90%">
            <tr>
              <td>
                <pre class="screen">
snmpwalk -v2c -c public host_name:161 .1.3.6.1.2.1.2.2.1.10
</pre>
              </td>
            </tr>
          </table>
        </div>

        <p>In the previous example the query is performed on the
        host "host_name", using default settings for snmp
        (transport = UDP; port = 161; community = public). The
        output should look like this:</p>

        <table xmlns="http://www.w3.org/TR/xhtml1/transitional"
        border="0" bgcolor="#E0E0E0" width="90%">
          <tr>
            <td>
              <pre class="screen">
IF-MIB::ifInOctets.1 = Counter32: 1430 
IF-MIB::ifInOctets.2 = Counter32: 966737519
</pre>
            </td>
          </tr>
        </table>

        <p>For more information in how to configure and use SNMP:
        <a href="http://www.net-snmp.org/" target=
        "_top">http://www.net-snmp.org/</a>MonALISAprovides snmp
        modules to collect:</p>

        <div class="itemizedlist">
          <ul type="disc">
            <li>
              <p>IO traffic from nodes and network elements</p>
            </li>

            <li>
              <p>CPU usage</p>
            </li>

            <li>
              <p>System Load</p>
            </li>

            <li>
              <p>Disk IO traffic</p>
            </li>

            <li>
              <p>etc.</p>
            </li>
          </ul>
        </div>

        <p>Here are the OIDs that must be "exported" by the snmpd
        daemon in order to allow various dedicated MonALISA snmp
        modules to collect the data:</p>

        <div class="variablelist">
          <dl>
            <dt><span class="term">snmp_IO</span></dt>

            <dd>
              <p>Incoming / outgoing network traffic:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
IN: .1.3.6.1.2.1.2.2.1.10 
OUT: .1.3.6.1.2.1.2.2.1.16
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">snmp_Load</span></dt>

            <dd>
              <p>Load5, Load10 and Load15:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
.1.3.6.1.4.1.2021.10.1.3
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">snmp_CPU</span></dt>

            <dd>
              <p>CPU_usr, CPU_nice and CPU_idle:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
.1.3.6.1.4.1.2021.11
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">snmp_MEM</span></dt>

            <dd>
              <p>MEM_free, Swap_MEM_Free</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
.1.3.6.1.4.1.2021.4
</pre>
                  </td>
                </tr>
              </table>
            </dd>

            <dt><span class="term">snmp_Disk</span></dt>

            <dd>
              <p>FreeDSK, UsedDsk:</p>

              <table xmlns=
              "http://www.w3.org/TR/xhtml1/transitional" border="0"
              bgcolor="#E0E0E0" width="90%">
                <tr>
                  <td>
                    <pre class="screen">
.1.3.6.1.4.1.2021.9
</pre>
                  </td>
                </tr>
              </table>
            </dd>
          </dl>
        </div>
      </div>
    </div>
  </div>
  <hr>

  <p align="center"><small>This, and other documents, can be
  downloaded from <a href=
  "http://monalisa.cacr.caltech.edu/">http://monalisa.cacr.caltech.edu/</a></small></p>

  <p align="center"><small>For questions about MonALISA, write at
  &lt;<a href=
  "mailto:support@monalisa.cern.ch">support@monalisa.cern.ch</a>&gt;.</small></p>
</body>
</html>
